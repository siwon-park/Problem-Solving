## [플3] 스위치 (1395번)

https://www.acmicpc.net/problem/1395

### 문제 유형

자료 구조, 세그먼트 트리, 느리게 갱신되는 세그먼트 트리

<br>

### 어려웠던 점 / 문제의 핵심

구간에 켜진 스위치의 개수를 구해야 하는 구간 합을 구하는 세그먼트 트리 응용 문제이다.

lazy 배열의 값을 전달하는 것과 스위치의 개수를 세는 로직이 중요한 문제로,

lazy 배열의 값은 `XOR 연산`을 통해 `0`과 `1`로 토글링한다.

즉, `lazy 배열의 값이 1이라면, 스위치 반전이 필요하다`라는 의미로 해석하면 된다.

0이면 끄고, 1이면 켜고 이런 로직으로 하면 계산은 더 복잡해지므로, 반전시켜야 할 일이 있음/없음을 판단하는 것으로만 사용하자.

따라서 `lazy배열의 값에 따라 구간 합을 계산하는 로직도 달라지는데`, 아래와 같이 계산하면 된다.

- lazy 배열의 값이 1일 경우
  - 홀수번 버튼을 눌렀다는 의미이므로, 스위치 반전이 필요함
  - 따라서 스위치의 개수도 반전되므로, `자식의 구간 - 자식의 현재 켜진 스위치 개수`로 계산한다.
- lazy 배열의 값이 0일 경우
  - 짝수번 버튼을 눌렀다는 의미이므로, 스위치 반전이 필요 없음
  - 따라서 자식의 현재 켜진 스위치 개수를 반환하면 됨

lazy를 전달하는 함수는 아래와 같이 작성한다.

```java
void lazyPropagation(int s, int e, int n) {
    if (lazy[n] != 0) {
        if (s != e) { // 리프 노드가 아닐 경우
            lazy[n * 2] ^= 1;
            lazy[n * 2 + 1] ^= 1;
            int tempCount = 0; // 오른쪽, 왼쪽의 상태에 따라 전구의 개수 반전(값이 1이면 반전 필요)
            int mid = (s + e) / 2; // 자식의 구간을 계산하기 위해 mid값을 사용
            if (lazy[n * 2] != 0) tempCount += (mid - s + 1) - tree[n * 2];
            else tempCount += tree[n * 2];
            if (lazy[n * 2 + 1] != 0) tempCount += (e - (mid + 1) + 1) - tree[n * 2 + 1];
            else tempCount += tree[n * 2 + 1];
            tree[n] = tempCount;
        } else { // 리프 노드일 경우
            tree[n] ^= 1;
        }
        lazy[n] = 0;
    }
}
```

- 구간 [1, 3]의 스위치 개수를 구하는 경우의 예시
  - 구간 [1, 3]의 스위치를 반전시킴
  - ![image](https://user-images.githubusercontent.com/93081720/236596637-e51c074a-c088-437a-b30d-f0d647e86ae4.png)
  - 구간 [1, 2]의 스위치를 반전시킴
    - 우선 update 호출 시점에서 현재 구간 [1, 2]의 lazy 값은 1이지만, 자식들에게 lazy 전달 후 0이 됨
    - 그렇지만 현재 구간 [1, 2]의 스위치는 켜진 상태이기 때문에  lazy 값을 다시 XOR 연산하여 1로 만들고, 자식들에게 lazy 전달 (또한 다시 현재 구간 [1, 2]의 lazy 값은 전달 후 0이 됨)
    - 자식의 lazy는 총 2번 토글링 되었으므로 그대로임
    - 따라서 자식의 값은 바뀐 적이 없음
  - ![image](https://user-images.githubusercontent.com/93081720/236598852-8a02c494-efa5-4a26-8650-e46d5853a1b7.png)

<br>

### 언어별 풀이 요약

| 언어   | 메모리   | 실행 시간(ms) | 시간복잡도 | 공간복잡도 | 풀이 시간 | 시도 횟수 | 해설 참고            |
| ------ | -------- | ------------- | ---------- | ---------- | --------- | --------- | -------------------- |
| Python |          |               |            |            |           |           |                      |
| Java   | 50816 KB | 752 ms        | O(MlogN)   | O(N * 4)   | 75분      | 2         | :white_large_square: |
| Kotlin |          |               |            |            |           |           |                      |

<br>

### 예외(테스트) 케이스

```
```

